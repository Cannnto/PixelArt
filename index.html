<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelArtGenerator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
<div class="menu" onclick="undoPopUps()">
        <div class="formulario">
                <button class="Toolsbutton" onclick="openSize()">SIZE</button>
                <button id="copy" class="Toolsbutton" onclick="copyMap">COPY</button>
                <button value="0" id="theme" class="Toolsbutton" onclick="changeTheme()">THEME</button>
        </div>
        <div class="tools">
            <button value="0" id="brush" class="Toolsbutton" onclick="brushOn()"><span class="material-symbols-outlined">brush</span></button>
            <button value="0" id="eraser" class="Toolsbutton" onclick="eraserOn()"><span class="material-symbols-outlined">ink_eraser</span></button>
            <input type="color" id="color" class="Toolsbutton">
        </div>
</div>
<div class="content" onclick="undoPopUps()">

</div>

<div class="size">
    <div class="sizeContent">
        <div class="labels">
            <label for="">Width:</label>
            <input type="number" id="rows" min="0" value="0">
        </div>
        <div class="labels">
            <label for="">Height:</label>
            <input type="number" id="coluns" min="0" value="0">
        </div>
        <button class="apply" id="submit">APPLY</button>
    </div>
</div>

<script src="Grid.js"></script>
<script src="settings.js"></script>
<script>
        var canvas = document.createElement("canvas");
        var ctx = canvas.getContext("2d");
        document.querySelector(".content").appendChild(canvas);
        canvas.width = 800;
        canvas.height = 800;
        
        document.querySelector('#submit').addEventListener('click', atualiza);
        document.querySelector('#copy').addEventListener('click', copyMap);
        var eraser = document.querySelector('#eraser');
        var color = document.querySelector('#color');
        var theme = document.querySelector('#theme');
        var themeBackground = "black";
        var time = 0

        function changeTheme()
        {   theme.value = (Number(document.querySelector('#theme').value)+1)%2;
            if(Number(theme.value)) themeBackground = 'rgb(173,164,164)';
            else themeBackground = 'black';
            console.log(themeBackground)
        }
        
        function brushOn()
        {   eraser.value = 0
        }

        function eraserOn()
        {   eraser.value = 1
        }

        function atualiza()
        {   var size = document.querySelector(".size")
            size.style.display = "none"
            grid.coluns = Number(document.querySelector('#coluns').value);
            grid.rows = Number(document.querySelector('#rows').value);
            grid.updateMap();
        }

        function openSize()
        {   time = new Date()
            var size = document.querySelector(".size")
            size.style.display = "flex"
        }

        function undoPopUps()
        {   
            var size = document.querySelector(".size")
            if(new Date()-time > 100)
            {
                size.style.display = "none"
            }
        }
            
        function copyMap()
        {   navigator.clipboard.writeText(`[${grid.map}], [${grid.colors}]`)

        }

        var loop = setInterval(loop,1000/30);
        var grid = new Grid(10,10);

        function loop()
        {   ctx.fillStyle = themeBackground;
            ctx.fillRect(0, 0, canvas.width, canvas.height);      

            // console.log(theme.value)

            grid.draw(Number(theme.value));
            var mouseCanvasX = (mouse.x - canvas.getBoundingClientRect().left);
            var mouseCanvasY = (mouse.y - canvas.getBoundingClientRect().top);
            if(keys[1] &&  mouseCanvasX >= 0 && mouseCanvasY >= 0 && mouseCanvasX < canvas.width && mouseCanvasY < canvas.height)   grid.update(mouseCanvasX, mouseCanvasY, Number(eraser.value));
            grid.iterate(color.value);
        }
    </script>
</body>
</html>